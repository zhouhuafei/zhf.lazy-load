"use strict";var extend=require("zhf.extend"),getDomArray=require("zhf.get-dom-array"),offset=require("zhf.offset");function LazyLoad(t){this.opts=extend({element:".g-lazy-load",srcAttr:"data-src",moreHeight:0,interval:80,isInitRender:!0,currentClass:"g-lazy-load",activeClass:"g-lazy-load-active"},t),this.clientHeight=document.documentElement.clientHeight,this.init()}LazyLoad.prototype.init=function(){this.opts.isInitRender&&this.render(),this.power()},LazyLoad.prototype.render=function(){var t=this,e=this.opts,r=e.moreHeight,o=(document.documentElement.scrollTop||document.body.scrollTop)-r,i=this.clientHeight+o+r,s=getDomArray(e.element),A=e.currentClass,a=e.activeClass;s.forEach(function(t){"img"===t.tagName.toLowerCase()&&(t.getAttribute("src")||(t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUCB1jYAACAAAFAAGNu5vzAAAAAElFTkSuQmCC"),t.setAttribute("height","100%"),t.setAttribute("width","100%"))}),s.forEach(function(e){if(e.offsetWidth){var r=offset(e).top;r+e.offsetHeight>=o&&r<=i&&("img"===e.tagName.toLowerCase()?(e.getAttribute(t.opts.srcAttr)&&(e.src=e.getAttribute(t.opts.srcAttr)),e.removeAttribute("height"),e.removeAttribute("width")):e.getAttribute(t.opts.srcAttr)&&(e.style.backgroundImage="url("+e.getAttribute(t.opts.srcAttr)+")"),e.classList.remove(A),e.classList.add(a))}})},LazyLoad.prototype.power=function(){var t=this,e=null;window.addEventListener("scroll",function(){clearTimeout(e),e=setTimeout(function(){t.render()},t.opts.interval)})},module.exports=LazyLoad;